<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}IntelliHub{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'intellihub-primary': '#7c3aed',
                        'intellihub-primary-dark': '#6d28d9',
                        'intellihub-secondary': '#ec4899',
                        'intellihub-surface': '#1f2937',
                        'intellihub-surface-light': '#374151',
                        'sidebar-bg': '#171717',
                        'sidebar-hover': '#262626'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-in-right': 'slideInRight 0.3s ease-out',
                        'slide-out-left': 'slideOutLeft 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        slideOutLeft: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-100%)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #4b5563 transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        .sidebar-transition {
            transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
        }

        .content-transition {
            transition: margin-left 0.3s ease-in-out;
        }

        .prose code {
            background-color: #374151 !important;
            color: #e5e7eb !important;
            padding: 0.125rem 0.25rem !important;
            border-radius: 0.25rem !important;
        }
        
        .prose pre {
            background-color: #1f2937 !important;
            border: 1px solid #374151 !important;
        }
        
        .prose pre code {
            background-color: transparent !important;
        }
    </style>
</head>
<body class="h-full bg-gray-900 text-white overflow-x-hidden overflow-y-auto" x-data="sidebarManager()" x-init="initSidebar()">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div 
            :class="sidebarOpen ? 'w-80' : 'w-0'"
            class="sidebar-transition bg-sidebar-bg border-r border-gray-700 flex flex-col overflow-hidden"
        >
            <!-- Sidebar Content -->
            <div class="flex flex-col h-full w-80">
                <!-- Header -->
                <div class="flex items-center justify-between p-4 border-b border-gray-700">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-intellihub-primary to-intellihub-secondary rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <h1 class="text-lg font-bold bg-gradient-to-r from-intellihub-primary to-intellihub-secondary bg-clip-text text-transparent">
                            IntelliHub
                        </h1>
                    </div>
                </div>

                <!-- New Chat Button -->
                <div class="p-4">
                    <a href="/" class="flex items-center space-x-3 w-full p-3 bg-gray-800 hover:bg-gray-700 rounded-xl transition-all duration-200 group border border-gray-600">
                        <div class="w-6 h-6 rounded-full bg-white flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-plus text-gray-900 text-xs"></i>
                        </div>
                        <span class="text-white font-medium">New Chat</span>
                    </a>
                </div>

                <!-- Navigation Menu -->
                <nav class="px-4 space-y-1">
                    <a href="/" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                        <i class="fas fa-comments text-gray-400 group-hover:text-white transition-colors"></i>
                        <span class="text-gray-300 group-hover:text-white transition-colors">Chat</span>
                    </a>
                    
                    <div class="border-t border-gray-700 my-2"></div>
                    
                    <!-- Others Dropdown -->
                    <div x-data="{ open: false }" class="relative">
                        <button @click="open = !open" class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-ellipsis-h text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Others</span>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400 group-hover:text-white transition-all duration-200" :class="open ? 'rotate-180' : 'rotate-0'"></i>
                        </button>
                        
                        <div x-show="open" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 transform scale-95" x-transition:enter-end="opacity-100 transform scale-100" x-transition:leave="transition ease-in duration-150" x-transition:leave-start="opacity-100 transform scale-100" x-transition:leave-end="opacity-0 transform scale-95" class="mt-1 ml-4 space-y-1 border-l-2 border-gray-600 pl-4">
                            
                            <!-- WEB IDE - Featured -->
                            <a href="{% url 'ide_dashboard' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg bg-gradient-to-r from-intellihub-primary/20 to-purple-600/20 border border-intellihub-primary/50 hover:from-intellihub-primary/30 hover:to-purple-600/30 transition-all group">
                                <i class="fas fa-code text-intellihub-primary group-hover:text-purple-400 transition-colors"></i>
                                <span class="text-white font-semibold group-hover:text-purple-100 transition-colors">Web IDE</span>
                                <span class="ml-auto text-xs bg-intellihub-primary text-white px-2 py-0.5 rounded-full">NEW</span>
                            </a>
                            
                            <a href="{% url 'image_generation' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-image text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Generate Images</span>
                            </a>
                            <a href="{% url 'image_gallery' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-photo-video text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Image Gallery</span>
                            </a>
                            <a href="{% url 'video_generation' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-video text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Generate Videos</span>
                            </a>
                            <a href="{% url 'video_gallery' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-film text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Video Gallery</span>
                            </a>
                            <a href="{% url 'audio_generation' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-microphone text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Generate Audio</span>
                            </a>
                            <a href="{% url 'audio_gallery' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-music text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Audio Gallery</span>
                            </a>
                            <a href="{% url 'presentation_generation' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-presentation-screen text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Generate Presentations</span>
                            </a>
                            <a href="{% url 'presentation_gallery' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-sidebar-hover transition-colors group">
                                <i class="fas fa-file-powerpoint text-gray-400 group-hover:text-white transition-colors"></i>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Presentation Gallery</span>
                            </a>
                        </div>
                    </div>
                </nav>

                <!-- Conversations Section -->
                <div class="flex-1 flex flex-col min-h-0 mt-6">
                    <div class="px-4 mb-3">
                        <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Recent Chats</h2>
                    </div>
                    <div class="flex-1 overflow-y-auto custom-scrollbar px-4">
                        {% block conversations %}
                        <div class="text-gray-500 text-sm text-center py-8">
                            <i class="fas fa-comments mb-2 text-xl opacity-50"></i>
                            <p>No conversations yet</p>
                        </div>
                        {% endblock %}
                    </div>
                </div>

                <!-- User Profile -->
                <div class="border-t border-gray-700 p-4">
                    {% if user.is_authenticated %}
                    <div class="flex items-center space-x-3 p-2 rounded-lg hover:bg-sidebar-hover transition-colors">
                        <div class="w-8 h-8 bg-intellihub-primary rounded-full flex items-center justify-center text-white font-bold text-sm">
                            {{ user.username.0|upper }}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-white truncate">{{ user.username }}</p>
                            <p class="text-xs text-gray-400">{{ user.email|default:"User" }}</p>
                        </div>
                        <div class="relative" x-data="{ dropdownOpen: false }">
                            <button @click="dropdownOpen = !dropdownOpen" class="text-gray-400 hover:text-white">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                            <div x-show="dropdownOpen" @click.away="dropdownOpen = false" 
                                 class="absolute bottom-full right-0 mb-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 py-1 z-50">
                                <a href="/logout/" class="flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                                    <i class="fas fa-sign-out-alt mr-2"></i>
                                    Sign out
                                </a>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <a href="/login/" class="flex items-center justify-center space-x-2 w-full p-3 bg-intellihub-primary hover:bg-intellihub-primary-dark rounded-lg transition-colors">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Sign In</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Overlay for mobile -->
        <div 
            x-show="sidebarOpen && isMobile" 
            @click="closeSidebar()" 
            class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
        ></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0">
            <!-- Top Bar -->
            <header class="bg-gray-900 border-b border-gray-700 px-4 py-3 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <!-- Sidebar Toggle -->
                    <button 
                        @click="toggleSidebar()" 
                        class="p-2 rounded-lg hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-intellihub-primary"
                    >
                        <i class="fas fa-bars text-gray-400 hover:text-white"></i>
                    </button>
                    
                    <!-- Page Title -->
                    <h1 class="text-lg font-semibold text-white">
                        {% block page_title %}Chat{% endblock %}
                    </h1>
                </div>

                <!-- Right Side Actions -->
                <div class="flex items-center space-x-2">
                    <!-- Add any additional header actions here -->
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto overflow-x-hidden bg-gray-900">
                {% block content %}
                <div class="h-full flex items-center justify-center">
                    <div class="text-center">
                        <i class="fas fa-brain text-6xl text-intellihub-primary mb-4"></i>
                        <h2 class="text-2xl font-bold text-white mb-2">Welcome to IntelliHub</h2>
                        <p class="text-gray-400">Your intelligent AI assistant</p>
                    </div>
                </div>
                {% endblock %}
            </main>
        </div>
    </div>

    <script>
        function sidebarManager() {
            return {
                sidebarOpen: true,
                isMobile: false,

                initSidebar() {
                    this.checkMobile();
                    window.addEventListener('resize', () => this.checkMobile());
                    
                    // Auto-close sidebar on mobile
                    if (this.isMobile) {
                        this.sidebarOpen = false;
                    }
                },

                checkMobile() {
                    this.isMobile = window.innerWidth < 1024;
                    
                    // Auto-close sidebar on mobile
                    if (this.isMobile && this.sidebarOpen) {
                        this.sidebarOpen = false;
                    }
                },

                toggleSidebar() {
                    this.sidebarOpen = !this.sidebarOpen;
                    
                    // Save preference in localStorage
                    if (!this.isMobile) {
                        localStorage.setItem('sidebar-open', this.sidebarOpen);
                    }
                },

                closeSidebar() {
                    this.sidebarOpen = false;
                },

                mounted() {
                    // Restore sidebar state from localStorage on desktop
                    if (!this.isMobile) {
                        const saved = localStorage.getItem('sidebar-open');
                        if (saved !== null) {
                            this.sidebarOpen = saved === 'true';
                        }
                    }
                }
            }
        }
    </script>

    {% block extra_scripts %}
    {% endblock %}
</body>
</html>
